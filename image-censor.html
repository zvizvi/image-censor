<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
	<script src="src/jquery.min.js"></script>
	<script src="src/jquery.selectareas/jquery.selectareas.js"></script>
	<link href="src/jquery.selectareas/jquery.selectareas.css" media="screen" rel="stylesheet" type="text/css" />
	<title>Image Censor</title>
	<style type="text/css">
	* {
		box-sizing: border-box;
	}
	body {
		margin: 0;
		padding: 0;
	}
	.content {
		display: flex;
	}
	.section {
		flex: 1;
		padding: 0 15px 15px;
		border: solid 1px #aaa;
		height: 99vh;
		text-align: center;
	}
	header {
		margin: 5px auto 15px;
	}
	.input-continer {
		margin: 15px auto;
		direction: ltr;
	}
	#input-url {
		width: 90%;
	}
	.image-continer {
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none;
	}
	#preview-image {
		box-shadow: 1px 1px 5px #aaa;
		border: solid 2px #fff;
	}
	.buttons {
		display: none;
		margin: 15px auto;
	}
	.buttons button {
		cursor: pointer;
		margin: 0 10px;
	}
	.section2 {
		flex: 0 200px;
		overflow: auto;
		border-left: 0;
		border-right: 0;
	}
	pre {
		text-align: left;
		direction: ltr;
	}
	#canvas {
		box-shadow: 1px 1px 5px #aaa;
		border: solid 2px #fff;
	}
	.canvas-wrap {
		display: inline-block;
		position: relative;
	}
	.canvas-select {
		position: absolute;
		left: 0;
		right: 100%;
		top: 0;
		bottom: 100%;
		border: solid 1px #000;
	}
	</style>
	<script type="text/javascript">
	$(document).ready(function() {

		var input = $('#input-url');
		var prevImg = $('#preview-image');
		var pre = $('pre');
		var btns = $('.buttons');
		var btnReset = $('#button-reset');
		var btnSave = $('#button-save');

		selectAreasSet = function() {
			prevImg.selectAreas({
				minSize: [5, 5]
			});
			btns.show();
		};
		selectAreasReset = function() {
			prevImg.selectAreas('reset');
			pre.html('');
			
		};
		selectAreasDestroy = function() {
			prevImg.selectAreas('destroy');
			pre.html('');
			btns.hide();
			
		};
		selectAreasSave = function() {
			var areas = prevImg.selectAreas('areas');
			var jsonAreas = JSON.stringify(areas, null, 2)
			pre.html(jsonAreas);
			setCanvas();
		};

		// preview & edit image
		input.on('change', function() {
			selectAreasDestroy();
			prevImg.attr('src', input.val());
		});
		prevImg.on('load', selectAreasSet );
		btnReset.on('click', selectAreasReset );
		btnSave.on('click', selectAreasSave );


		// canvas;
		var canvas = $('#canvas');
		setCanvasSize = function() {
			canvas.attr('width', prevImg.width() + 'px').attr('height', prevImg.height() + 'px');
		};
		setCanvasImage = function() {
			context = canvas[0].getContext('2d');
			var image = new Image();
			image.src = prevImg[0].src;
			image.onload = function() {
				context.drawImage(image, 0, 0);
			};
		};
		setCanvas = function() {
			setCanvasSize();
			setCanvasImage();
		};

		//init
		input.val('https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png').trigger('change');
	});
	</script>
</head>
<body>
	<div class="content">
		<div class="section section1">
			<header>
				<span>Client Side</span>
			</header>
			<div>
				<div class="input-continer">
					<label for="input-url">URL
						<input type="text" id="input-url" name="input-url">
					</label>
				</div>
				<div class="image-continer" style="display:inline-block;text-align:right;">
					<img src="" id="preview-image">
				</div>
				<div class="buttons">
					<button class="button" id="button-reset">Reset</button>
					<button class="button" id="button-save">Save</button>
				</div>
				<!-- <span>https://www.google.com/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png</span> -->
			</div>
		</div>
		<div class="section section2">
			<header>
				<span>Service</span>
			</header>
			<pre>
				
			</pre>
		</div>
		<div class="section section3">
			<header>
				<span>Server Side</span>
			</header>
			<div class="canvas-wrap">
				<!--
			-->
				<canvas id="canvas" width="0" height="0	"></canvas>
				<!--
			-->
				<div class="canvas-select"></div>
				<!--
		-->
			</div>
		</div>
	</div>
</body>
</html>
